<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member List</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Add Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/common/styles/main.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Roboto', Arial, sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }
        body {
            display: flex;
            flex-direction: column;
        }
        #content {
            flex: 1 0 auto;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 28px;
            text-align: left;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            background-color: #ffffff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        .table thead {
            background-color: #3498db;
            color: #ffffff;
        }
        .table tbody tr:hover {
            background-color: #f5f5f5;
        }
        .risk-high { color: #d32f2f; font-weight: bold; }
        .risk-medium { color: #f57c00; }
        .risk-low { color: #388e3c; }
        footer {
            flex-shrink: 0;
            background-color: #34495e;
            padding: 15px;
            text-align: right;
            color: #ecf0f1;
        }
        #aiHubLink {
            text-decoration: none;
            color: #ecf0f1;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        #aiHubLink:hover {
            color: #3498db;
        }
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.15;
            z-index: -1;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .summarizing {
            color: #f39c12; /* Orange color */
            display: flex;
            align-items: center;
        }
        .summarizing i {
            margin-right: 8px;
            animation: spin 2s linear infinite;
        }
        .summary-cell {
            min-width: 200px;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <main>
            <div id="header"></div>
            <section id="main-content">
                <div id="content">
                    <h1>Member List</h1>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Member Name</th>
                                <th>Gender</th>
                                <th>Date of Birth</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Risk Level</th>
                                <th>Patient Summary</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Example rows, replace with dynamic data -->
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=1" data-id="1">John Doe</a></td>
                                <td>Male</td>
                                <td>1985-05-15</td>
                                <td>(555) 123-4567</td>
                                <td>john.doe@example.com</td>
                                <td class="risk-high">High</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=2" data-id="2">Jane Smith</a></td>
                                <td>Female</td>
                                <td>1990-08-22</td>
                                <td>(555) 987-6543</td>
                                <td>jane.smith@example.com</td>
                                <td class="risk-low">Low</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=3" data-id="3">Robert Johnson</a></td>
                                <td>Male</td>
                                <td>1978-11-30</td>
                                <td>(555) 246-8135</td>
                                <td>robert.johnson@example.com</td>
                                <td class="risk-high">High</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=4" data-id="4">Emily Brown</a></td>
                                <td>Female</td>
                                <td>1992-03-18</td>
                                <td>(555) 369-2580</td>
                                <td>emily.brown@example.com</td>
                                <td class="risk-low">Low</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=5" data-id="5">Michael Wilson</a></td>
                                <td>Male</td>
                                <td>1980-09-05</td>
                                <td>(555) 147-2589</td>
                                <td>michael.wilson@example.com</td>
                                <td class="risk-medium">Medium</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=6" data-id="6">Sarah Davis</a></td>
                                <td>Female</td>
                                <td>1988-12-10</td>
                                <td>(555) 753-9514</td>
                                <td>sarah.davis@example.com</td>
                                <td class="risk-high">High</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=7" data-id="7">David Martinez</a></td>
                                <td>Male</td>
                                <td>1995-06-25</td>
                                <td>(555) 951-7532</td>
                                <td>david.martinez@example.com</td>
                                <td class="risk-low">Low</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=8" data-id="8">Lisa Anderson</a></td>
                                <td>Female</td>
                                <td>1983-02-14</td>
                                <td>(555) 852-9630</td>
                                <td>lisa.anderson@example.com</td>
                                <td class="risk-medium">Medium</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=9" data-id="9">James Taylor</a></td>
                                <td>Male</td>
                                <td>1976-08-30</td>
                                <td>(555) 741-8520</td>
                                <td>james.taylor@example.com</td>
                                <td class="risk-high">High</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=10" data-id="10">Emma Thomas</a></td>
                                <td>Female</td>
                                <td>1993-11-07</td>
                                <td>(555) 369-1470</td>
                                <td>emma.thomas@example.com</td>
                                <td class="risk-low">Low</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-user-circle fa-2x"></i> <a href="landing_page.html?id=11" data-id="11">Christopher Lee</a></td>
                                <td>Male</td>
                                <td>1987-04-20</td>
                                <td>(555) 258-7410</td>
                                <td>christopher.lee@example.com</td>
                                <td class="risk-medium">Medium</td>
                                <td class="summary-cell">
                                    <span class="summarizing">
                                        <i class="fas fa-sync-alt"></i>Summarizing
                                    </span>
                                </td>
                            </tr>
   
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <footer>
        <!--a href="#" id="aiHubLink"><i class="fas fa-user-md"></i> Clinical Companion</a-->
    </footer>

    <div id="chatPopup" class="hidden">
        <!-- Chat popup content (same as in orders.html) -->
    </div>

    <input type="hidden" id="pageName" value="member_list_page">

    <!--script src="script.js"></script-->
    <script>
        // Load components
        fetch('common/html/header.html').then(response => response.text()).then(data => document.getElementById('header').innerHTML = data);

        // Fetch summaries from the API
        async function fetchSummaries() {
            const summaryElements = document.querySelectorAll('.summary-cell span');
            const patientLinks = document.querySelectorAll('td a[data-id]');
            const patientIds = Array.from(patientLinks).map(link => link.getAttribute('data-id'));
            let requestBody = {                              
                history: [],    
                intent:"system-intent",
                entity:"memberlist_page",
                message:"patient_summary",
                patient_ids:patientIds
            };
    
            try {
                console.log('Request body:', requestBody);
                const response = await fetch('http://127.0.0.1:8000/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody),
                });

                const responseText = await response.text();
                console.log('Raw response:', responseText);

                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('Error parsing JSON:', parseError);
                    throw new Error('Invalid JSON response from server');
                }

                console.log('Parsed data:', data);

                if (data && data.llm_response && data.llm_response.response) {
                    let summaries;
                    try {
                        summaries = JSON.parse(data.llm_response.response);
                    } catch (summaryParseError) {
                        console.error('Error parsing summaries:', summaryParseError);
                        throw new Error('Invalid summary data in server response');
                    }

                    summaryElements.forEach((element, index) => {
                        const summary = summaries.find(s => s.patient_id === patientIds[index]);
                        if (summary) {
                            element.textContent = summary.summary;
                            element.classList.remove('summarizing');
                        } else {
                            element.textContent = 'Summary not available';
                            element.classList.remove('summarizing');
                        }
                    });
                } else {
                    throw new Error('Unexpected response structure from server');
                }
            } catch (error) {
                console.error('Error fetching summaries:', error);
                summaryElements.forEach(element => {
                    element.textContent = 'Error fetching summary';
                    element.classList.remove('summarizing');
                });
            }
        }

        // Call the function when the page loads
        window.addEventListener('load', fetchSummaries);
    </script>
</body>
</html>
